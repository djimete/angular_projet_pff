<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Working Express - Garde d'Enfants et Nannies</title>
</head>
<body>

<!-- Barre de Navigation (Header) -->
<header class="bg-white shadow-md sticky top-0 z-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-indigo-600">
      <a href="#" onclick="showView('list-view')">WorkingExpress</a>
    </h1>
    <a href="#" class="text-gray-600 hover:text-indigo-600 transition duration-150">Mon Tableau de Bord</a>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

  <!-- ============================================== -->
  <!-- ============== 1. VUE LISTE ================== -->
  <!-- ============================================== -->
  <section id="list-view">

    <!-- Titre et Description de la Cat√©gorie (Garde d'Enfants) -->
    <section class="mb-10 text-center md:text-left">
      <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
        Garde d'Enfants <span class="childcare-color">üß∏</span>
      </h2>
      <p class="text-xl text-gray-500">Trouvez une nounou ou assistante maternelle qualifi√©e pr√®s de chez vous.</p>
    </section>

    <!-- Barre de Filtres et de Recherche Sp√©cifique (Laisser tel quel) -->
    <form id="filter-form" class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Affiner votre recherche</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="text" id="filter-location" placeholder="Ville ou quartier (ex: Dakar)"
               class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
        <select id="filter-age" class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none">
          <option value="all">Toutes tranches d'√¢ge</option>
          <option value="bebe">B√©b√©s (0-2 ans)</option>
          <option value="maternelle">Maternelle (3-5 ans)</option>
          <option value="primaire">Primaire (6-12 ans)</option>
        </select>
        <div class="flex items-center space-x-2 p-3 bg-gray-50 rounded-lg">
          <input type="checkbox" id="filter-urgent" class="w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
          <label for="filter-urgent" class="text-gray-700">Disponible Imm√©diatement</label>
        </div>
        <button type="submit" id="apply-filters-btn" class="px-6 py-3 bg-pink-600 text-white font-bold rounded-lg shadow-md hover:bg-pink-700 transition duration-300">
          Appliquer les Filtres
        </button>
      </div>
    </form>

    <!-- Liste des Prestataires de Garde d'Enfants -->
    <section>
      <h3 id="results-count" class="text-2xl font-bold text-gray-800 mb-6">3 Prestataires trouv√©s</h3>

      <!-- Conteneur qui sera peupl√© dynamiquement par le JS -->
      <div id="providers-list" class="space-y-6">
        <!-- Les cartes des prestataires seront g√©n√©r√©es ici par le script JavaScript -->
      </div>
      <!-- Message affich√© si aucun r√©sultat n'est trouv√© -->
      <div id="no-results" class="hidden text-center p-8 bg-pink-50 rounded-lg border border-pink-200 mt-6">
        <p class="text-xl text-pink-800 font-semibold">Aucun prestataire de garde d'enfants ne correspond √† vos crit√®res de recherche. Essayez d'√©largir votre zone ou vos filtres.</p>
      </div>
    </section>
  </section>

  <!-- ============================================== -->
  <!-- =========== 2. VUE D√âTAIL / R√âSERVATION ====== -->
  <!-- ============================================== -->
  <section id="detail-view" class="hidden">
    <button onclick="showView('list-view')" class="text-pink-600 hover:text-pink-800 font-semibold mb-6 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
      Retour √† la liste
    </button>

    <!-- D√©tails du prestataire (sera mis √† jour par JS) -->
    <div id="detail-content" class="bg-white p-8 rounded-xl shadow-2xl transition-all duration-300">
      <!-- Contenu Dynamique ici -->
    </div>

    <!-- Simulation d'Acceptation de Demande -->
    <div id="reservation-section" class="mt-8 p-6 bg-pink-50 border border-pink-200 rounded-xl hidden">
      <h3 class="text-2xl font-bold text-pink-800 mb-4">Demande accept√©e ! üéâ</h3>
      <p class="text-gray-700 mb-4">Votre demande de r√©servation a √©t√© **accept√©e** par <span id="accepted-nanny-name" class="font-bold"></span>. Vous pouvez maintenant proc√©der au paiement pour confirmer la prestation.</p>
      <p class="text-lg font-semibold text-gray-800 mb-4">Montant de la prestation √† payer : <span id="prestation-montant" class="text-pink-600 font-bold"></span></p>
      <button onclick="showPaymentForm(currentNannyId, 55.00)" class="px-8 py-3 bg-pink-600 text-white font-bold rounded-lg hover:bg-pink-700 transition duration-300 w-full md:w-auto">
        Effectuer le Paiement Maintenant
      </button>
    </div>
  </section>

  <!-- ============================================== -->
  <!-- ============= 3. VUE PAIEMENT ================ -->
  <!-- ============================================== -->
  <section id="payment-view" class="hidden">
    <button onclick="showView('detail-view')" class="text-pink-600 hover:text-pink-800 font-semibold mb-6 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
      Annuler et revenir √† la demande
    </button>

    <div class="w-full max-w-lg mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-2xl transition-all duration-300">

      <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Paiement S√©curis√© <span class="childcare-color">üîí</span></h1>
      <p class="text-center text-gray-500 mb-6">Paiement pour <span id="payment-for-nanny" class="font-semibold text-pink-600"></span></p>

      <!-- Section du Montant (Champ commun et manuel) -->
      <div class="mb-6 border-b pb-4 border-indigo-100">
        <label for="payment-montant" class="block text-sm font-medium text-gray-700 mb-2">Montant √† Payer (Saisie manuelle)</label>
        <div class="relative rounded-lg shadow-sm">
          <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <span class="text-gray-500 sm:text-sm font-semibold">‚Ç¨</span>
          </div>
          <input type="number" id="payment-montant" name="montant" placeholder="55.00" min="0.01" step="0.01" required
                 class="block w-full rounded-lg border-2 border-indigo-300 py-3 pl-10 pr-4 text-gray-900 placeholder:text-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm sm:leading-6 transition duration-150 ease-in-out">
        </div>
      </div>

      <!-- Section Choix de la M√©thode de Paiement -->
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Choisir la m√©thode de paiement</h2>

      <div id="payment-options" class="space-y-4 mb-8">
        <!-- Choix 1: Carte Bancaire -->
        <label class="flex items-center p-4 bg-blue-50 border-2 border-blue-200 rounded-xl cursor-pointer hover:bg-blue-100 transition duration-150 ease-in-out has-[:checked]:border-blue-600 has-[:checked]:ring-2 has-[:checked]:ring-blue-500">
          <input type="radio" name="payment_method" value="carte" class="form-radio h-5 w-5 text-blue-600 focus:ring-blue-500" onclick="showPaymentFields('carte')">
          <span class="ml-3 text-lg font-medium text-gray-800">Carte Bancaire (Visa, Mastercard)</span>
        </label>

        <!-- Choix 2: Orange-Money -->
        <label class="flex items-center p-4 bg-orange-50 border-2 border-orange-200 rounded-xl cursor-pointer hover:bg-orange-100 transition duration-150 ease-in-out has-[:checked]:border-orange-600 has-[:checked]:ring-2 has-[:checked]:ring-orange-500">
          <input type="radio" name="payment_method" value="orange" class="form-radio h-5 w-5 text-orange-600 focus:ring-orange-500" onclick="showPaymentFields('orange')">
          <span class="ml-3 text-lg font-medium text-gray-800">Orange-Money (Mobile)</span>
        </label>

        <!-- Choix 3: Wave -->
        <label class="flex items-center p-4 bg-teal-50 border-2 border-teal-200 rounded-xl cursor-pointer hover:bg-teal-100 transition duration-150 ease-in-out has-[:checked]:border-teal-600 has-[:checked]:ring-2 has-[:checked]:ring-teal-500">
          <input type="radio" name="payment_method" value="wave" class="form-radio h-5 w-5 text-teal-600 focus:ring-teal-500" onclick="showPaymentFields('wave')">
          <span class="ml-3 text-lg font-medium text-gray-800">Wave (Mobile)</span>
        </label>
      </div>

      <!-- Conteneur pour les champs sp√©cifiques (Initialement vide/cach√©) -->
      <div id="specific-fields-container">

        <!-- Champs pour Carte Bancaire -->
        <div id="fields-carte" class="hidden space-y-4 p-5 bg-blue-50 border border-blue-200 rounded-lg">
          <h3 class="text-lg font-bold text-blue-800">D√©tails de la Carte</h3>

          <div>
            <label for="card_number" class="block text-sm font-medium text-gray-700">Num√©ro de Carte</label>
            <input type="text" id="card_number" placeholder="xxxx xxxx xxxx xxxx"
                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500" disabled>
          </div>
          <div class="grid grid-cols-3 gap-4">
            <div class="col-span-2">
              <label for="expiry_date" class="block text-sm font-medium text-gray-700">Date d'Expiration (MM/AA)</label>
              <input type="text" id="expiry_date" placeholder="01/25"
                     class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500" disabled>
            </div>
            <div>
              <label for="cvv" class="block text-sm font-medium text-gray-700">CVV</label>
              <input type="text" id="cvv" placeholder="123" maxlength="3"
                     class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500" disabled>
            </div>
          </div>
        </div>

        <!-- Champs pour Orange-Money -->
        <div id="fields-orange" class="hidden space-y-4 p-5 bg-orange-50 border border-orange-200 rounded-lg">
          <h3 class="text-lg font-bold text-orange-800">Paiement Orange-Money</h3>

          <div>
            <label for="orange_phone" class="block text-sm font-medium text-gray-700">Num√©ro Orange-Money</label>
            <input type="tel" id="orange_phone" placeholder="+221 77 XX XXX XX"
                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-orange-500 focus:ring-orange-500" disabled>
          </div>

          <div>
            <label for="orange_pin" class="block text-sm font-medium text-gray-700">Code Pin / Validation</label>
            <input type="password" id="orange_pin" placeholder="Code secret de l'application mobile"
                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-orange-500 focus:ring-orange-500" disabled>
          </div>
        </div>

        <!-- Champs pour Wave -->
        <div id="fields-wave" class="hidden space-y-4 p-5 bg-teal-50 border border-teal-200 rounded-lg">
          <h3 class="text-lg font-bold text-teal-800">Paiement Wave</h3>

          <div>
            <label for="wave_phone" class="block text-sm font-medium text-gray-700">Num√©ro Wave</label>
            <input type="tel" id="wave_phone" placeholder="+221 76 XX XXX XX"
                   class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:border-teal-500 focus:ring-teal-500" disabled>
          </div>

          <p class="text-sm text-teal-700">Vous recevrez une notification sur votre t√©l√©phone pour valider le paiement.</p>
        </div>

      </div>

      <!-- Bouton de Soumission -->
      <div class="mt-8">
        <button id="submit-payment-button" disabled
                class="w-full py-3 px-4 rounded-xl text-white font-semibold text-lg bg-gray-400 cursor-not-allowed transition duration-150 ease-in-out shadow-lg hover:shadow-xl disabled:opacity-50">
          S√©lectionnez une m√©thode de paiement
        </button>
      </div>

    </div>
  </section>

</main>

<!-- Pied de Page (Footer) -->
<footer class="bg-gray-800 text-white mt-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
    <p>&copy; 2025 Working Express. Tous droits r√©serv√©s.</p>
  </div>
</footer>

<!-- Script JavaScript pour g√©rer les vues et la logique m√©tier -->
<script>
  // --- DATA SIMULATION ---
  const providers = {
    'khadijas': { id: 'khadijas', name: 'Khadija S.', title: 'Assistante Maternelle agr√©√©e | Sp√©cialis√©e B√©b√©s', location: 'Dakar', rate: '5‚Ç¨ / heure', imgText: 'K1', reviews: 68, rating: 4.9, ageGroups: ['bebe', 'maternelle'], availability: 'now', profileContent: 'Khadija a 8 ans d\'exp√©rience et est sp√©cialis√©e dans les soins aux nourrissons (0-2 ans). Elle est agr√©√©e par l\'√âtat du S√©n√©gal. Elle est disponible du Lundi au Vendredi.' },
    'mansourd': { id: 'mansourd', name: 'Mansour D.', title: 'Coach scolaire et p√©riscolaire | Aide aux devoirs', location: 'Rufisque', rate: '10‚Ç¨ / heure', imgText: 'M2', reviews: 15, rating: 4.7, ageGroups: ['primaire'], availability: 'soon', profileContent: 'Mansour est titulaire d\'un Master en √âducation. Il se concentre sur l\'aide aux devoirs et les activit√©s parascolaires pour les enfants de 6 √† 12 ans. Il propose des cr√©neaux en soir√©e.' },
    'aminac': { id: 'aminac', name: 'Amina C.', title: 'Nourrice avec r√©f√©rences | Garde temps plein', location: 'Dakar', rate: 'Forfait mensuel (sur devis)', imgText: 'A3', reviews: 22, rating: 4.3, ageGroups: ['maternelle', 'primaire'], availability: 'booking', profileContent: 'Amina propose une garde √† temps plein (40h/semaine). Elle a d\'excellentes r√©f√©rences et est disponible pour une longue dur√©e. Contactez-la pour un devis.' }
  };

  let currentNannyId = null; // ID du prestataire actuellement affich√© en d√©tail/paiement

  // --- GESTION DES VUES ---

  /**
   * Affiche la vue demand√©e et cache les autres.
   * @param {string} viewId - ID de la vue √† afficher ('list-view', 'detail-view', 'payment-view')
   */
  function showView(viewId) {
    document.getElementById('list-view').classList.add('hidden');
    document.getElementById('detail-view').classList.add('hidden');
    document.getElementById('payment-view').classList.add('hidden');

    const viewElement = document.getElementById(viewId);
    if (viewElement) {
      viewElement.classList.remove('hidden');
      window.scrollTo(0, 0); // Remonter en haut de page
    }
  }

  /**
   * Affiche les d√©tails d'un prestataire (Vue 2).
   * @param {string} id - L'ID du prestataire.
   */
  function showDetails(id) {
    currentNannyId = id;
    const nanny = providers[id];
    const detailContent = document.getElementById('detail-content');

    if (!nanny) {
      alertUser('Prestataire non trouv√©.', 'error');
      showView('list-view');
      return;
    }

    // R√©initialiser la section de r√©servation/paiement
    document.getElementById('reservation-section').classList.add('hidden');

    detailContent.innerHTML = `
                <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                    <img src="https://placehold.co/120x120/ec4899/ffffff?text=${nanny.imgText}" alt="Photo de ${nanny.name}" class="w-32 h-32 rounded-full border-4 border-pink-500 shadow-md">

                    <div>
                        <h2 class="text-3xl font-bold text-gray-900 mb-1">${nanny.name}</h2>
                        <p class="text-xl text-pink-600 mb-2">${nanny.title}</p>

                        <!-- Notation d√©taill√©e -->
                        <div class="flex items-center mb-4">
                            <span class="text-lg font-bold mr-2 text-gray-800">${nanny.rating}</span>
                            ${generateStars(nanny.rating)}
                            <span class="text-md text-gray-500 ml-3">(${nanny.reviews} Avis v√©rifi√©s)</span>
                        </div>

                        <!-- D√©tails de la Prestation -->
                        <p class="text-gray-700 mb-4">${nanny.profileContent}</p>

                        <div class="flex flex-wrap gap-4">
                            <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Zone: ${nanny.location}</span>
                            <span class="bg-pink-100 text-pink-800 text-sm font-medium px-3 py-1 rounded-full">Tarif: ${nanny.rate}</span>
                        </div>

                        <!-- Bouton Faire une demande (simule une action) -->
                        <button onclick="simulateReservationDemand('${nanny.id}')"
                                class="mt-6 px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300">
                            Faire une demande de r√©servation
                        </button>
                    </div>
                </div>
            `;

    showView('detail-view');
  }

  /**
   * Simule le processus de demande de r√©servation et l'acceptation.
   * @param {string} id - L'ID du prestataire.
   */
  function simulateReservationDemand(id) {
    const nanny = providers[id];
    const reservationSection = document.getElementById('reservation-section');

    alertUser(`Demande de r√©servation envoy√©e √† ${nanny.name}. Simulation d'attente...`, 'info');

    // Simuler un d√©lai d'attente pour l'acceptation
    setTimeout(() => {
      const montantPrestation = 55.00; // Montant fixe pour la simulation

      document.getElementById('accepted-nanny-name').textContent = nanny.name;
      document.getElementById('prestation-montant').textContent = `${montantPrestation.toFixed(2)} ‚Ç¨`;

      // Mettre √† jour la fonction de paiement avec l'ID et le montant
      const payButton = reservationSection.querySelector('button');
      payButton.setAttribute('onclick', `showPaymentForm('${id}', ${montantPrestation})`);

      reservationSection.classList.remove('hidden');
      alertUser(`La demande de ${nanny.name} a √©t√© accept√©e !`, 'success');

      window.scrollTo(0, document.body.scrollHeight); // Scroll vers le bas pour voir le message
    }, 2500); // 2.5 secondes de d√©lai simul√©
  }

  /**
   * Affiche le formulaire de paiement (Vue 3).
   * @param {string} id - L'ID du prestataire.
   * @param {number} amount - Le montant pr√©-d√©fini.
   */
  function showPaymentForm(id, amount) {
    const nanny = providers[id];

    // Pr√©-remplir le montant dans le champ de saisie manuel
    const montantInput = document.getElementById('payment-montant');
    montantInput.value = amount.toFixed(2);

    document.getElementById('payment-for-nanny').textContent = nanny.name;

    // R√©initialiser les radios et champs sp√©cifiques
    document.querySelectorAll('input[name="payment_method"]').forEach(radio => radio.checked = false);
    showPaymentFields(null);

    showView('payment-view');
  }


  // --- LOGIQUE DYNAMIQUE DU PAIEMENT (ADAPT√âE) ---

  /**
   * Affiche les champs de saisie sp√©cifiques √† la m√©thode de paiement s√©lectionn√©e.
   * C'est ici que sont appliqu√©es les exigences de champs propres et de d√©sactivation/activation.
   * @param {string|null} method - La m√©thode s√©lectionn√©e ('carte', 'orange', 'wave').
   */
  function showPaymentFields(method) {
    const allFieldsContainers = document.querySelectorAll('#specific-fields-container > div');
    const submitButton = document.getElementById('submit-payment-button');

    // 1. Cacher et d√©sactiver tous les inputs sp√©cifiques
    allFieldsContainers.forEach(container => {
      container.classList.add('hidden');
      // D√©sactiver tous les inputs dans ce conteneur
      container.querySelectorAll('input').forEach(input => input.disabled = true);
    });

    // 2. Afficher et activer les inputs pour la m√©thode s√©lectionn√©e
    const selectedFields = document.getElementById(`fields-${method}`);
    if (selectedFields) {
      selectedFields.classList.remove('hidden');
      // Activer les inputs sp√©cifiques
      selectedFields.querySelectorAll('input').forEach(input => input.disabled = false);
    }

    // 3. Activer et personnaliser le bouton de soumission
    if (method) {
      submitButton.disabled = false;
      submitButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
      submitButton.classList.add('bg-pink-600', 'hover:bg-pink-700');
      submitButton.textContent = `Payer ${document.getElementById('payment-montant').value} ‚Ç¨ via ${getFriendlyMethodName(method)}`;
    } else {
      submitButton.disabled = true;
      submitButton.classList.remove('bg-pink-600', 'hover:bg-pink-700');
      submitButton.classList.add('bg-gray-400', 'cursor-not-allowed');
      submitButton.textContent = 'S√©lectionnez une m√©thode de paiement';
    }
  }

  /**
   * Nom convivial pour la m√©thode de paiement.
   */
  function getFriendlyMethodName(method) {
    switch (method) {
      case 'carte': return 'Carte Bancaire';
      case 'orange': return 'Orange-Money';
      case 'wave': return 'Wave';
      default: return 'M√©thode Inconnue';
    }
  }

  /**
   * G√®re la soumission du paiement simul√©.
   */
  document.getElementById('submit-payment-button').addEventListener('click', function(e) {
    e.preventDefault();
    const montant = document.getElementById('payment-montant').value;
    const selectedMethod = document.querySelector('input[name="payment_method"]:checked')?.value;

    if (!montant || parseFloat(montant) <= 0 || !selectedMethod) {
      alertUser('Veuillez saisir un montant valide et s√©lectionner une m√©thode de paiement.', 'error');
      return;
    }

    // Validation minimale (√† √©tendre dans une vraie application)
    let isFormValid = true;
    const specificInputs = document.getElementById(`fields-${selectedMethod}`).querySelectorAll('input');
    specificInputs.forEach(input => {
      if (input.value.trim() === '' && input.type !== 'password') {
        isFormValid = false;
      }
    });

    if (!isFormValid) {
      alertUser(`Veuillez remplir tous les champs requis pour le paiement par ${getFriendlyMethodName(selectedMethod)}.`, 'error');
      return;
    }

    const nannyName = providers[currentNannyId]?.name || 'le prestataire';
    const message = `Paiement r√©ussi de ${parseFloat(montant).toFixed(2)} ‚Ç¨ via ${getFriendlyMethodName(selectedMethod)} pour ${nannyName}. La r√©servation est confirm√©e !`;
    alertUser(message, 'success');

    // Retourner √† la liste apr√®s un paiement r√©ussi simul√©
    setTimeout(() => showView('list-view'), 3000);
  });


  // --- LOGIQUE DE RENDU DYNAMIQUE DES CARTES ---

  /**
   * G√©n√®re le HTML pour une carte de prestataire individuelle.
   * @param {object} nanny - Les donn√©es du prestataire.
   */
  function generateProviderCardHtml(nanny) {
    const isAvailableNow = nanny.availability === 'now';
    const availabilityText = isAvailableNow ? 'Disponible Maintenant' : (nanny.availability === 'soon' ? 'Bient√¥t Disponible' : 'Sur R√©servation');
    const borderClass = isAvailableNow ? 'border-pink-500' : 'border-gray-300';

    // Animation ping uniquement pour "Disponible Maintenant"
    const pingHtml = isAvailableNow ? `
                <span class="relative flex h-2 w-2 mr-2">
                    <span class="animate-ping-pink absolute inline-flex h-full w-full rounded-full ping-pink opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-pink-500"></span>
                </span>
            ` : '';

    const availabilityClasses = isAvailableNow ? 'text-pink-700 bg-pink-100' : 'text-gray-700 bg-gray-100';

    return `
                <div class="provider-card bg-white p-6 rounded-xl shadow-lg border-l-4 ${borderClass} flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0"
                    data-id="${nanny.id}"
                    data-age-group="${nanny.ageGroups.join(',')}"
                    data-availability="${nanny.availability}"
                    data-location="${nanny.location}">

                    <div class="flex items-center space-x-4 w-full md:w-auto">
                        <a href="#" onclick="showDetails('${nanny.id}')">
                            <img src="https://placehold.co/80x80/ec4899/ffffff?text=${nanny.imgText}" alt="Photo de ${nanny.name}" class="w-16 h-16 rounded-full border-2 border-pink-500">
                        </a>
                        <div>
                            <a href="#" onclick="showDetails('${nanny.id}')" class="text-xl font-bold text-gray-900 hover:text-pink-600 transition">${nanny.name}</a>
                            <p class="text-gray-600">${nanny.title}</p>
                            <div class="flex items-center mt-1">
                                <span class="text-sm font-bold mr-1 text-gray-800">${nanny.rating}</span>
                                ${generateStars(nanny.rating)}
                                <span class="text-sm text-gray-500 ml-2">(${nanny.reviews} Avis)</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col items-start md:items-end space-y-2">
                        <div class="availability-status flex items-center font-semibold ${availabilityClasses} px-3 py-1 rounded-full">
                            ${pingHtml}
                            ${availabilityText}
                        </div>
                        <p class="text-2xl font-bold text-pink-600">${nanny.rate}</p>
                        <button onclick="showDetails('${nanny.id}')" class="px-5 py-2 bg-pink-600 text-white font-semibold rounded-lg hover:bg-pink-700 transition duration-300">
                            Contacter
                        </button>
                    </div>
                </div>
            `;
  }

  /**
   * Rend la liste compl√®te des prestataires dans le DOM et initialise les filtres.
   */
  function renderProviderList() {
    const listContainer = document.getElementById('providers-list');
    let htmlContent = '';

    // Convertir l'objet en tableau pour it√©rer sur tous les prestataires
    Object.values(providers).forEach(nanny => {
      htmlContent += generateProviderCardHtml(nanny);
    });

    listContainer.innerHTML = htmlContent;

    // Mise √† jour du compteur de r√©sultats initial
    document.getElementById('results-count').textContent = `${Object.keys(providers).length} Prestataires trouv√©s`;

    // Retourne les cartes nouvellement cr√©√©es pour les filtres
    return document.querySelectorAll('.provider-card');
  }


  // --- FONCTIONS UTILITAIRES ---

  /**
   * G√©n√®re le HTML pour les √©toiles de notation.
   */
  function generateStars(rating) {
    const fullStars = Math.floor(rating);
    const remainingStars = 5 - fullStars;
    let starsHtml = '';
    for (let i = 0; i < fullStars; i++) {
      starsHtml += `<span class="rating-star">&#9733;</span>`;
    }
    // Ajouter les √©toiles gris√©es pour compl√©ter
    for (let i = 0; i < remainingStars; i++) {
      starsHtml += `<span class="rating-star text-gray-300">&#9733;</span>`;
    }
    return starsHtml;
  }

  /**
   * Affiche un message √† l'utilisateur au lieu d'alert().
   */
  function alertUser(message, type) {
    let messageBox = document.getElementById('user-message-box');
    if (!messageBox) {
      messageBox = document.createElement('div');
      messageBox.id = 'user-message-box';
      messageBox.className = 'fixed top-0 left-0 right-0 p-4 text-center z-50 transition-all duration-300 transform -translate-y-full';
      document.body.appendChild(messageBox);
    }

    const baseClasses = 'inline-flex items-center justify-center px-4 py-3 rounded-xl font-semibold shadow-lg text-white';
    let specificClasses = '';

    if (type === 'success') {
      specificClasses = 'bg-green-600';
    } else if (type === 'error') {
      specificClasses = 'bg-red-600';
    } else {
      specificClasses = 'bg-indigo-600';
    }

    messageBox.innerHTML = `<p class="${baseClasses} ${specificClasses}">${message}</p>`;

    // Animer pour afficher
    messageBox.classList.remove('-translate-y-full');
    messageBox.classList.add('translate-y-0');

    // Animer pour masquer apr√®s 4 secondes
    setTimeout(() => {
      messageBox.classList.remove('translate-y-0');
      messageBox.classList.add('-translate-y-full');
    }, 4000);
  }

  /**
   * Initialisation de la page et des filtres.
   */
  document.addEventListener('DOMContentLoaded', () => {
    // Afficher la vue de liste au chargement
    showView('list-view');

    // 1. Rendre la liste des prestataires (et obtenir la r√©f√©rence des cartes)
    const providerCards = renderProviderList();

    // --- Logique des Filtres ---
    const filterForm = document.getElementById('filter-form');
    const resultsCount = document.getElementById('results-count');
    const noResultsMessage = document.getElementById('no-results');

    function applyFilters(e) {
      e.preventDefault();
      const locationFilter = document.getElementById('filter-location').value.trim().toLowerCase();
      const ageFilter = document.getElementById('filter-age').value;
      const urgentFilter = document.getElementById('filter-urgent').checked;

      let visibleCount = 0;

      providerCards.forEach(card => {
        const cardLocation = card.dataset.location.toLowerCase();
        const cardAgeGroups = card.dataset.ageGroup.split(',');
        const cardAvailability = card.dataset.availability;

        let isMatch = true;

        if (locationFilter && !cardLocation.includes(locationFilter)) {
          isMatch = false;
        }
        if (ageFilter !== 'all' && !cardAgeGroups.includes(ageFilter)) {
          isMatch = false;
        }
        if (urgentFilter && cardAvailability !== 'now') {
          isMatch = false;
        }

        if (isMatch) {
          card.style.display = 'flex';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      if (visibleCount > 0) {
        resultsCount.textContent = `${visibleCount} Prestataire(s) trouv√©(s) dans votre r√©gion`;
        noResultsMessage.classList.add('hidden');
      } else {
        resultsCount.textContent = `0 Prestataire trouv√©`;
        noResultsMessage.classList.remove('hidden');
      }
    }

    // 2. Attacher l'√©v√©nement de soumission du formulaire de filtre
    filterForm.addEventListener('submit', applyFilters);

    // 3. Mettre √† jour le bouton de paiement en cas de changement manuel du montant
    document.getElementById('payment-montant').addEventListener('input', () => {
      const selectedMethod = document.querySelector('input[name="payment_method"]:checked')?.value;
      if (selectedMethod) {
        // Mettre √† jour le texte du bouton si une m√©thode est s√©lectionn√©e
        const submitButton = document.getElementById('submit-payment-button');
        submitButton.textContent = `Payer ${document.getElementById('payment-montant').value} ‚Ç¨ via ${getFriendlyMethodName(selectedMethod)}`;
      }
    });
  });
</script>

</body>
</html>

