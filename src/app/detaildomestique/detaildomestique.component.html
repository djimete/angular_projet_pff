<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Working Express - √âlectriciens et Disponibilit√©s</title>
</head>
<body>

<!-- Barre de Navigation (Header) -->
<header class="bg-white shadow-md sticky top-0 z-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-indigo-600"><a href="#" onclick="showListView()">WorkingExpress</a></h1>
    <a href="#" class="text-gray-600 hover:text-indigo-600 transition duration-150">Mon Tableau de Bord</a>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

  <!-- ============================================== -->
  <!-- SECTION 1: VUE DE LA LISTE DES PRESTATAIRES -->
  <!-- ============================================== -->
  <div id="list-view">

    <!-- Titre et Description de la Cat√©gorie (√âlectricit√©) -->
    <section class="mb-10 text-center md:text-left">
      <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
        √âlectricit√© <span class="primary-text-color">üí°</span>
      </h2>
      <p class="text-xl text-gray-500">Trouvez un √©lectricien qualifi√© disponible pr√®s de chez vous.</p>
    </section>

    <!-- Barre de Filtres et de Recherche Sp√©cifique -->
    <form id="filter-form" class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Affiner votre recherche</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <!-- Filtre Localisation -->
        <input type="text" id="filter-location" placeholder="Ville ou code postal (ex: Dakar)"
               class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">

        <!-- Filtre Type de Service (√âlectricit√©) -->
        <select id="filter-service" class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 appearance-none">
          <option value="all">Tous les services</option>
          <option value="panne">Panne √©lectrique urgente</option>
          <option value="installation_prise">Installation de prise/lumi√®re</option>
          <option value="tableau">Remplacement tableau √©lectrique</option>
        </select>

        <!-- Filtre Disponibilit√© Imm√©diate -->
        <div class="flex items-center space-x-2 p-3 bg-gray-50 rounded-lg">
          <input type="checkbox" id="filter-urgent" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
          <label for="filter-urgent" class="text-gray-700">Disponible Maintenant (Urgence)</label>
        </div>

        <!-- Bouton Appliquer les Filtres -->
        <button type="submit" id="apply-filters-btn" class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300">
          Appliquer les Filtres
        </button>
      </div>
    </form>

    <!-- Liste des Prestataires √âlectriciens -->
    <section>
      <!-- L'ID 'results-count' sera mis √† jour par le JavaScript -->
      <h3 id="results-count" class="text-2xl font-bold text-gray-800 mb-6">3 √âlectriciens trouv√©s dans votre r√©gion</h3>

      <div id="plumbers-list" class="space-y-6">
        <!-- Les cartes des prestataires seront g√©n√©r√©es ici par JavaScript -->
      </div>

      <!-- Message affich√© si aucun r√©sultat n'est trouv√© -->
      <div id="no-results" class="hidden text-center p-8 bg-yellow-50 rounded-lg border border-yellow-200 mt-6">
        <p class="text-xl text-yellow-800 font-semibold">Aucun √©lectricien ne correspond √† vos crit√®res de recherche. Essayez d'√©largir votre zone ou vos filtres.</p>
      </div>
    </section>

  </div> <!-- Fin #list-view -->

  <!-- ============================================== -->
  <!-- SECTION 2: VUE D√âTAILL√âE DU PRESTATAIRE -->
  <!-- ============================================== -->
  <div id="detail-view" class="hidden">
    <button onclick="showListView()" class="mb-6 inline-flex items-center text-indigo-600 hover:text-indigo-800 font-semibold transition">
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
      Retour √† la liste des √©lectriciens
    </button>

    <div class="bg-white p-8 rounded-xl shadow-2xl border border-gray-100">

      <!-- En-t√™te du Profil -->
      <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-x-8 md:space-y-0 pb-6 border-b border-gray-200">
        <img id="detail-img" src="" alt="Photo du prestataire" class="w-24 h-24 rounded-full border-4 border-indigo-500 object-cover">
        <div class="text-center md:text-left">
          <h2 id="detail-name" class="text-4xl font-extrabold text-gray-900 mb-1">Nom du Prestataire</h2>
          <p id="detail-title" class="text-xl text-gray-600 mb-2">Titre/Sp√©cialit√©</p>

          <!-- Notation D√©taill√©e -->
          <div class="flex items-center justify-center md:justify-start">
            <span id="detail-rating-stars" class="rating-star text-2xl mr-2"></span>
            <span id="detail-rating-value" class="text-2xl font-bold text-gray-800 mr-2">5.0</span>
            <span id="detail-reviews-count" class="text-md text-gray-500">(112 Avis)</span>
          </div>
        </div>
      </div>

      <!-- D√©tails du Service et Description -->
      <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Colonne 1 : Description -->
        <div class="lg:col-span-2">
          <h3 class="text-2xl font-bold primary-text-color mb-4">√Ä propos de ce prestataire</h3>
          <p id="detail-description" class="text-gray-700 leading-relaxed mb-6"></p>

          <h4 class="text-xl font-bold text-gray-800 mb-3">Services Sp√©cialis√©s</h4>
          <div id="detail-services" class="flex flex-wrap gap-2">
            <!-- Les services seront inject√©s ici -->
          </div>
        </div>

        <!-- Colonne 2 : Disponibilit√© & Action (Incluant le flux de r√©servation) -->
        <div class="lg:col-span-1 bg-indigo-50 p-6 rounded-xl shadow-inner sticky top-28">
          <h4 class="text-lg font-bold text-indigo-800 mb-3">Statut Actuel</h4>
          <div id="detail-availability" class="mb-4 text-xl font-bold text-green-700"></div>

          <h4 class="text-lg font-bold text-indigo-800 mb-3">Tarification</h4>
          <p id="detail-rate" class="text-3xl font-extrabold text-indigo-600 mb-6"></p>

          <!-- CONTENEUR DU FLUX DE R√âSERVATION -->
          <div id="booking-container" class="space-y-4">

            <!-- √âTAPE 0: Bouton Initial (visible par d√©faut) -->
            <button id="detail-action-btn" onclick="initiateBooking(this.dataset.providerId)" data-provider-id="" class="w-full px-5 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300 shadow-lg">
              R√©server l'intervention
            </button>

            <!-- √âTAPE 1: Confirmation en attente (cach√©e) -->
            <div id="booking-step-1" class="hidden text-center p-4 bg-yellow-100 rounded-lg shadow-md border border-yellow-300">
              <p class="font-bold text-yellow-800 mb-2">Demande de R√©servation Envoy√©e !</p>
              <p class="text-sm text-yellow-700">En attente de la confirmation du prestataire...</p>
              <div class="loader mt-3"></div>
            </div>

            <!-- √âTAPE 2: Options de Paiement et Champs D√©taill√©s (cach√©e) -->
            <div id="booking-step-2" class="hidden text-center p-4 bg-green-100 rounded-xl shadow-md border border-green-300">
              <p class="font-bold text-green-800 text-xl mb-4">Confirmation Re√ßue ! Choisissez le mode de paiement</p>

              <!-- S√©lection du mode de paiement (visible initialement) -->
              <div id="payment-selection" class="space-y-3 mb-4">
                <button onclick="showPaymentFields('Card')" class="w-full py-3 text-white font-semibold rounded-lg transition shadow-md btn-card flex items-center justify-center">
                  <span class="text-2xl mr-2">üí≥</span> Payer par Carte Bancaire
                </button>
                <button onclick="showPaymentFields('OrangeMoney')" class="w-full py-3 text-white font-semibold rounded-lg transition shadow-md btn-om flex items-center justify-center">
                  <span class="text-2xl mr-2">üçä</span> Payer par Orange Money
                </button>
                <button onclick="showPaymentFields('Wave')" class="w-full py-3 text-white font-semibold rounded-lg transition shadow-md btn-wave flex items-center justify-center">
                  <span class="text-2xl mr-2">üåä</span> Payer par Wave
                </button>
              </div>

              <!-- Conteneur pour les champs de paiement dynamiques (cach√© initialement) -->
              <div id="payment-fields" class="hidden text-left p-4 border border-green-400 bg-white rounded-lg">
                <!-- Le formulaire de champs d√©taill√©s appara√Ætra ici -->
              </div>
            </div>

            <!-- √âTAPE 3: Succ√®s (cach√©e) -->
            <div id="booking-step-3" class="hidden text-center p-6 bg-lime-100 rounded-xl shadow-lg border border-lime-300">
              <p class="text-2xl font-extrabold text-lime-800 mb-2">‚úÖ Paiement R√©ussi !</p>
              <p class="text-gray-700">Votre r√©servation est confirm√©e. Le prestataire vous contactera sous peu.</p>
              <button onclick="showListView()" class="mt-4 px-4 py-2 bg-lime-700 text-white rounded-lg hover:bg-lime-800 transition">Retourner √† la liste</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Section des Avis Clients -->
      <div class="mt-12 pt-8 border-t border-gray-200">
        <h3 class="text-3xl font-bold text-gray-900 mb-6">Avis Clients (<span id="review-count-header">112</span>)</h3>
        <div id="detail-reviews-list" class="space-y-6">
          <!-- Les avis seront inject√©s ici -->
        </div>
      </div>

    </div>
  </div> <!-- Fin #detail-view -->

</main>

<!-- Pied de Page (Footer) -->
<footer class="bg-gray-800 text-white mt-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
    <p>&copy; 2025 Working Express. Tous droits r√©serv√©s. Navigation SPA activ√©e.</p>
  </div>
</footer>

<!-- Script JavaScript pour g√©rer les donn√©es, les filtres et l'affichage des vues -->
<script>
  // ==============================================
  // 1. DATA MODEL
  // ==============================================
  const providersData = [
    {
      id: 'fatou',
      name: 'Fatou D.',
      title: 'Experte en d√©pannage urgent | 8 ans d\'exp√©rience',
      location: 'Dakar',
      rating: 5.0,
      reviewsCount: 112,
      availabilityCode: 'now',
      availabilityText: 'DISPONIBLE MAINTENANT (URGENCE)',
      rate: '50‚Ç¨ / heure (d√©placement inclus)',
      buttonText: 'R√©server pour intervention urgente',
      services: ['Panne √©lectrique urgente', 'Installation de prise/lumi√®re', 'Remplacement tableau √©lectrique'],
      detailDescription: "Fatou est la meilleure de la r√©gion de Dakar pour toutes les urgences √©lectriques. Certifi√©e et rapide, elle garantit une intervention sous 30 minutes pour les pannes. Elle est sp√©cialis√©e dans les diagnostics complexes et le respect des normes de s√©curit√© internationales. Son tarif est horaire, parfait pour les interventions rapides.",
      reviews: [
        { author: "Moussa K.", date: "1 sem.", text: "Intervention ultra-rapide et probl√®me r√©solu en 10 minutes. 5 √©toiles m√©rit√©es!" },
        { author: "Awa B.", date: "1 mois", text: "Professionnelle et tr√®s courtoise. Elle a pris le temps d'expliquer l'origine de la panne." },
        { author: "Omar N.", date: "2 mois", text: "Sauv√© d'une coupure en pleine nuit ! Je recommande les yeux ferm√©s." }
      ],
      imgCode: '059669',
      borderColor: 'green-500',
      statusBg: 'bg-green-100',
      statusText: 'text-green-700'
    },
    {
      id: 'ibrahima',
      name: 'Ibrahima F.',
      title: '√âlectricien certifi√© | Installation et r√©novation',
      location: 'Rufisque',
      rating: 4.7,
      reviewsCount: 45,
      availabilityCode: 'soon',
      availabilityText: 'PROCHAIN CR√âNEAU : Aujourd\'hui 14h00',
      rate: '80‚Ç¨ / forfait installation',
      buttonText: 'R√©server ce cr√©neau',
      services: ['Installation de prise/lumi√®re', 'Remplacement tableau √©lectrique'],
      detailDescription: "Ibrahima se concentre sur les projets planifi√©s, l'installation de nouveaux √©quipements et la r√©novation compl√®te. Il propose des forfaits clairs et pr√©cis pour la pose d'interrupteurs ou le changement de tableaux √©lectriques. Moins disponible pour les urgences imm√©diates, mais id√©al pour un travail de qualit√© et durable.",
      reviews: [
        { author: "Khadija M.", date: "3 jours", text: "Excellent travail sur la r√©novation de mon tableau √©lectrique. Tr√®s propre et efficace." },
        { author: "David Z.", date: "2 sem.", text: "Le forfait est clair, pas de mauvaise surprise. Ponctuel √† 14h00 comme promis." }
      ],
      imgCode: 'f97316',
      borderColor: 'orange-500',
      statusBg: 'bg-orange-100',
      statusText: 'text-orange-700'
    },
    {
      id: 'aicha',
      name: 'A√Øcha G.',
      title: 'Sp√©cialiste en petit appareillage et devis',
      location: 'Dakar',
      rating: 4.3,
      reviewsCount: 18,
      availabilityCode: 'booking',
      availabilityText: 'SUR R√âSERVATION (D√©lai de 1 semaine)',
      rate: 'Prix sur devis',
      buttonText: 'Demander un devis / R√©server',
      services: ['Installation de prise/lumi√®re'],
      detailDescription: "A√Øcha est l'experte pour les petits travaux d'appareillage, l'ajout de points lumineux ou le tirage de c√¢bles simples. Elle travaille uniquement sur devis pour garantir la transparence des co√ªts. Son agenda est souvent rempli, d'o√π un d√©lai d'une semaine pour obtenir un cr√©neau.",
      reviews: [
        { author: "Jean L.", date: "1 mois", text: "Devis re√ßu rapidement et travail soign√©. Elle a parfaitement install√© les spots de ma cuisine." },
        { author: "Saly D.", date: "3 mois", text: "Un peu d'attente, mais le prix √©tait le meilleur du march√©." }
      ],
      imgCode: '9ca3af',
      borderColor: 'gray-400',
      statusBg: 'bg-gray-100',
      statusText: 'text-gray-700'
    }
  ];

  // Variable pour stocker le prestataire en cours de r√©servation
  let currentBookingProvider = null;

  // ==============================================
  // 2. RENDERING FUNCTIONS (CARDS & DETAILS)
  // ==============================================

  /**
   * G√©n√®re les √©toiles de notation sous forme de HTML
   * @param {number} rating
   * @returns {string} HTML string
   */
  function generateRatingHtml(rating) {
    let html = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= Math.floor(rating)) {
        html += '<span class="rating-star">&#9733;</span>'; // √âtoile pleine
      } else if (i - rating < 1 && i - rating > 0) {
        html += '<span class="rating-star">&#9733;</span>'; // Pour simplifier, on garde l'√©toile pleine si > X.0
      } else {
        html += '<span class="rating-star text-gray-300">&#9733;</span>'; // √âtoile vide
      }
    }
    return html;
  }

  /**
   * G√©n√®re le HTML pour une carte de prestataire individuelle.
   * @param {object} provider
   * @returns {string} HTML string
   */
  function renderProviderCard(provider) {
    let statusIndicator;
    if (provider.availabilityCode === 'now') {
      statusIndicator = `
                    <span class="relative flex h-3 w-3 mr-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-3 w-3 bg-green-600"></span>
                    </span>
                `;
    } else {
      statusIndicator = `<span class="w-3 h-3 mr-2 rounded-full ${provider.availabilityCode === 'soon' ? 'bg-orange-500' : 'bg-gray-500'}"></span>`;
    }

    return `
                <div class="plumber-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-${provider.borderColor} flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0 cursor-pointer"
                     data-provider-id="${provider.id}"
                     data-service="${provider.services.map(s => s.toLowerCase().replace(/ /g, '_')).join(',')}"
                     data-availability="${provider.availabilityCode}"
                     data-location="${provider.location.toLowerCase()}">

                    <div class="flex items-center space-x-4 w-full md:w-auto" onclick="showDetailView('${provider.id}')">
                        <img src="https://placehold.co/80x80/${provider.imgCode}/ffffff?text=${provider.name.charAt(0)}I" alt="Photo de ${provider.name}" class="w-16 h-16 rounded-full border-2 border-${provider.borderColor} object-cover">
                        <div>
                            <p class="text-xl font-bold text-gray-900 hover:text-indigo-600 transition">${provider.name}</p>
                            <p class="text-gray-600">${provider.title} (${provider.location})</p>

                            <!-- Notation -->
                            <div class="flex items-center mt-1">
                                <span class="text-sm font-bold mr-1 text-gray-800">${provider.rating.toFixed(1)}</span>
                                ${generateRatingHtml(provider.rating)}
                                <span class="text-sm text-gray-500 ml-2">(${provider.reviewsCount} Avis)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Disponibilit√© et Tarif -->
                    <div class="flex flex-col items-start md:items-end space-y-2">
                        <div class="availability-status flex items-center font-bold ${provider.statusText} ${provider.statusBg} px-4 py-1.5 rounded-full border border-${provider.borderColor.replace('-500', '-300')} text-xs">
                            ${statusIndicator}
                            ${provider.availabilityText}
                        </div>

                        <p class="text-2xl font-bold text-indigo-600">${provider.rate}</p>
                        <button onclick="showDetailView('${provider.id}')" class="px-5 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md">
                            ${provider.buttonText}
                        </button>
                    </div>
                </div>
            `;
  }

  /**
   * Affiche la vue de la liste et masque la vue d√©taill√©e.
   */
  function showListView() {
    document.getElementById('list-view').classList.remove('hidden');
    document.getElementById('detail-view').classList.add('hidden');
  }

  // ==============================================
  // 3. FLUX DE R√âSERVATION ET PAIEMENT DYNAMIQUE
  // ==============================================

  /**
   * Met √† jour l'affichage des √©tapes du flux de r√©servation.
   * @param {number} step - 0: Initial, 1: En attente, 2: Paiement, 3: Succ√®s
   */
  function updateBookingSteps(step) {
    // Masquer toutes les √©tapes et le bouton initial
    document.getElementById('detail-action-btn').classList.add('hidden');
    document.getElementById('booking-step-1').classList.add('hidden');
    document.getElementById('booking-step-2').classList.add('hidden');
    document.getElementById('booking-step-3').classList.add('hidden');

    switch (step) {
      case 0: // √âtat initial (bouton d'action standard)
        document.getElementById('detail-action-btn').classList.remove('hidden');
        break;
      case 1: // Confirmation en attente
        document.getElementById('booking-step-1').classList.remove('hidden');
        break;
      case 2: // Paiement requis
        document.getElementById('booking-step-2').classList.remove('hidden');
        break;
      case 3: // Succ√®s
        document.getElementById('booking-step-3').classList.remove('hidden');
        break;
    }
  }

  /**
   * D√©marre le processus de r√©servation.
   * @param {string} providerId
   */
  function initiateBooking(providerId) {
    currentBookingProvider = providersData.find(p => p.id === providerId);
    if (!currentBookingProvider) return;

    updateBookingSteps(1); // √âTAPE 1: Attente

    // Simulation de l'attente de confirmation du prestataire (2 secondes)
    setTimeout(simulateProviderConfirmation, 2000);
  }

  /**
   * Simule la confirmation du prestataire et passe √† l'√©tape de paiement.
   */
  function simulateProviderConfirmation() {
    updateBookingSteps(2); // √âTAPE 2: Paiement

    const providerName = currentBookingProvider ? currentBookingProvider.name : 'le prestataire';

    // Mise √† jour de l'√©tape 2 avec le nom du prestataire (pour un meilleur contexte)
    const step2El = document.getElementById('booking-step-2');
    step2El.querySelector('p:first-child').textContent = `Confirmation de ${providerName} Re√ßue ! Choisissez le mode de paiement`;

    // Afficher les boutons de s√©lection (initialisation)
    resetPaymentSelection();
  }

  /**
   * R√©initialise la vue pour choisir le mode de paiement.
   */
  function resetPaymentSelection() {
    document.getElementById('payment-selection').classList.remove('hidden');
    document.getElementById('payment-fields').classList.add('hidden');
    document.getElementById('payment-fields').innerHTML = ''; // Nettoyer le contenu
  }

  /**
   * Affiche les champs de saisie correspondant au mode de paiement s√©lectionn√©.
   * @param {string} method - 'Card', 'OrangeMoney', ou 'Wave'.
   */
  function showPaymentFields(method) {
    const fieldsContainer = document.getElementById('payment-fields');
    fieldsContainer.classList.remove('hidden');

    let formHtml = '';
    let formTitle = '';

    // Masquer les boutons de s√©lection pour se concentrer sur le formulaire
    document.getElementById('payment-selection').classList.add('hidden');

    switch (method) {
      case 'Card':
        formTitle = 'Paiement par Carte Bancaire';
        formHtml = `
                        <div class="space-y-3">
                            <input type="text" placeholder="Nom sur la Carte (ex: Jean Dupont)" id="card-name" required
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <input type="text" placeholder="Num√©ro de Carte (simul√©)" id="card-number" required
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <div class="flex space-x-2">
                                <input type="text" placeholder="MM/AA" id="card-expiry" required
                                       class="w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                <input type="text" placeholder="CVC" id="card-cvc" required
                                       class="w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                    `;
        break;

      case 'OrangeMoney':
        formTitle = 'Paiement par Orange Money (OM)';
        formHtml = `
                        <p class="text-sm text-gray-600 mb-2">Entrez votre num√©ro pour recevoir l'invite de paiement sur votre t√©l√©phone.</p>
                        <input type="tel" placeholder="Num√©ro de T√©l√©phone Orange Money (ex: 77XXXXXXX)" id="om-phone" required
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    `;
        break;

      case 'Wave':
        formTitle = 'Paiement par Wave';
        formHtml = `
                        <p class="text-sm text-gray-600 mb-2">Entrez votre num√©ro pour recevoir l'invite de paiement sur votre application Wave.</p>
                        <input type="tel" placeholder="Num√©ro de T√©l√©phone Wave (ex: 77XXXXXXX)" id="wave-phone" required
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    `;
        break;
    }

    // Conteneur du formulaire avec le bouton de validation
    fieldsContainer.innerHTML = `
                <h5 class="text-lg font-bold text-gray-800 mb-3 text-center">${formTitle}</h5>
                <form id="payment-form" onsubmit="event.preventDefault(); processPayment('${method}')">
                    ${formHtml}
                    <button type="submit" class="mt-4 w-full px-5 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-300 shadow-lg">
                        Valider et Payer
                    </button>
                    <button type="button" onclick="resetPaymentSelection()" class="mt-2 w-full px-5 py-2 text-gray-600 font-semibold rounded-lg hover:bg-gray-100 transition duration-300 border border-gray-300">
                        Changer de m√©thode
                    </button>
                    <p id="payment-error" class="text-red-500 mt-2 text-sm hidden">Veuillez remplir tous les champs.</p>
                </form>
            `;
  }

  /**
   * Simule le processus de paiement (avec une l√©g√®re validation).
   * @param {string} method - M√©thode de paiement choisie (pour le message).
   */
  function processPayment(method) {
    // Simple validation (v√©rifie si les champs requis sont remplis)
    const form = document.getElementById('payment-form');
    const inputs = form.querySelectorAll('input[required]');
    let isValid = true;

    inputs.forEach(input => {
      if (!input.value.trim()) {
        isValid = false;
      }
    });

    const errorEl = document.getElementById('payment-error');

    if (!isValid) {
      errorEl.textContent = 'Veuillez saisir les informations demand√©es pour continuer.';
      errorEl.classList.remove('hidden');
      return;
    }

    errorEl.classList.add('hidden');

    // Remplacer le formulaire par un indicateur de traitement
    const fieldsContainer = document.getElementById('payment-fields');
    fieldsContainer.innerHTML = `
                <div class="text-center p-4 bg-indigo-50 rounded-xl">
                    <p class="text-xl font-bold text-indigo-600 mb-3">Traitement du paiement par ${method}...</p>
                    <div class="loader mt-3"></div>
                </div>
            `;

    // Simulation du temps de traitement du paiement (1.5 seconde)
    setTimeout(() => {
      updateBookingSteps(3); // √âTAPE 3 (Succ√®s)
    }, 1500);
  }

  /**
   * Affiche la vue d√©taill√©e pour le prestataire donn√© et masque la vue de la liste.
   * @param {string} providerId - L'ID unique du prestataire.
   */
  function showDetailView(providerId) {
    const provider = providersData.find(p => p.id === providerId);
    if (!provider) {
      console.error('Prestataire non trouv√©:', providerId);
      return;
    }

    // 1. Mise √† jour des informations de base
    document.getElementById('detail-name').textContent = provider.name;
    document.getElementById('detail-title').textContent = provider.title + ' (' + provider.location + ')';
    document.getElementById('detail-img').src = `https://placehold.co/80x80/${provider.imgCode}/ffffff?text=${provider.name.charAt(0)}I`;
    document.getElementById('detail-img').alt = `Photo de ${provider.name}`;

    // 2. Mise √† jour de la notation
    document.getElementById('detail-rating-stars').innerHTML = generateRatingHtml(provider.rating);
    document.getElementById('detail-rating-value').textContent = provider.rating.toFixed(1);
    document.getElementById('detail-reviews-count').textContent = `(${provider.reviewsCount} Avis)`;
    document.getElementById('review-count-header').textContent = provider.reviewsCount;

    // 3. Mise √† jour de la description et des services
    document.getElementById('detail-description').textContent = provider.detailDescription;
    document.getElementById('detail-availability').textContent = provider.availabilityText;
    document.getElementById('detail-rate').textContent = provider.rate;

    // Configuration du bouton d'action et r√©initialisation du flux de r√©servation
    const actionBtn = document.getElementById('detail-action-btn');
    actionBtn.dataset.providerId = provider.id; // Stocke l'ID pour la r√©servation
    actionBtn.textContent = provider.buttonText; // Texte du bouton initial
    updateBookingSteps(0); // R√©initialise l'affichage au bouton initial

    // Mise √† jour des services
    const servicesContainer = document.getElementById('detail-services');
    servicesContainer.innerHTML = provider.services.map(service =>
      `<span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium">${service}</span>`
    ).join('');

    // 4. Mise √† jour des avis clients
    const reviewsContainer = document.getElementById('detail-reviews-list');
    reviewsContainer.innerHTML = provider.reviews.map(review => `
                <div class="border-b border-gray-100 pb-4">
                    <div class="flex items-center mb-1">
                        <span class="font-semibold text-gray-900 mr-2">${review.author}</span>
                        <span class="text-sm text-gray-500">il y a ${review.date}</span>
                    </div>
                    <p class="text-gray-700 italic">"${review.text}"</p>
                </div>
            `).join('');

    // 5. Bascule de l'affichage
    document.getElementById('list-view').classList.add('hidden');
    document.getElementById('detail-view').classList.remove('hidden');
    window.scrollTo(0, 0); // Remonter en haut de la page pour la nouvelle vue
  }

  // ==============================================
  // 4. FILTERS & INITIALIZATION LOGIC
  // ==============================================

  /**
   * Initialise les cartes des prestataires au chargement de la page.
   */
  function initializeCards() {
    const listContainer = document.getElementById('plumbers-list');
    listContainer.innerHTML = providersData.map(renderProviderCard).join('');

    // Applique les filtres au chargement (pour afficher le bon compteur)
    applyFilters({ preventDefault: () => {} });
  }

  /**
   * Applique les filtres s√©lectionn√©s par l'utilisateur pour masquer/afficher les cartes.
   */
  function applyFilters(e) {
    e.preventDefault();

    const locationFilter = document.getElementById('filter-location').value.trim().toLowerCase();
    const serviceFilter = document.getElementById('filter-service').value;
    const urgentFilter = document.getElementById('filter-urgent').checked;

    let visibleCount = 0;
    const plumberList = document.getElementById('plumbers-list');
    const plumberCards = plumberList.querySelectorAll('.plumber-card');

    plumberCards.forEach(card => {
      const cardLocation = card.dataset.location.toLowerCase();
      const cardServices = card.dataset.service.split(',');
      const cardAvailability = card.dataset.availability;

      let isMatch = true;

      // --- Crit√®re 1: Localisation ---
      if (locationFilter && !cardLocation.includes(locationFilter)) {
        isMatch = false;
      }

      // --- Crit√®re 2: Type de Service ---
      if (serviceFilter !== 'all' && !cardServices.includes(serviceFilter)) {
        isMatch = false;
      }

      // --- Crit√®re 3: Urgence ---
      if (urgentFilter && cardAvailability !== 'now') {
        isMatch = false;
      }

      // Afficher/Masquer
      if (isMatch) {
        card.style.display = 'flex';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Mise √† jour du compteur
    const resultsCount = document.getElementById('results-count');
    const noResultsMessage = document.getElementById('no-results');

    if (visibleCount > 0) {
      resultsCount.textContent = `${visibleCount} √âlectricien(s) trouv√©(s) dans votre r√©gion`;
      noResultsMessage.classList.add('hidden');
    } else {
      resultsCount.textContent = `0 √âlectricien trouv√©`;
      noResultsMessage.classList.remove('hidden');
    }
  }

  // ==============================================
  // 5. EVENT LISTENERS
  // ==============================================
  document.addEventListener('DOMContentLoaded', () => {
    const filterForm = document.getElementById('filter-form');
    filterForm.addEventListener('submit', applyFilters);

    initializeCards();
    showListView(); // Assure que la liste est la vue par d√©faut au chargement
  });
</script>

</body>
</html>
