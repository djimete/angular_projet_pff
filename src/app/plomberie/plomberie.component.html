<header class="bg-white shadow-md sticky top-0 z-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-indigo-600"><a routerLink="/">WorkingExpress</a></h1>
    <div id="auth-status" class="text-sm text-gray-600">Chargement de l'utilisateur...</div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:-px-8 py-12">

  <section id="list-view" *ngIf="!showDetailSection">

    <section class="mb-10 text-center md:text-left">
      <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">
        Plomberie <span class="text-indigo-600">üõ†Ô∏è</span>
      </h2>
      <p class="text-xl text-gray-500">Trouvez un plombier qualifi√© disponible pr√®s de chez vous.</p>
    </section>

    <form id="filter-form" (ngSubmit)="applyFilters($event)"
          class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Affiner votre recherche</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <input type="text" id="filter-location" placeholder="Ville ou code postal"
               [(ngModel)]="filterLocation" name="filterLocation"
               class="p-3 border border-gray-300 rounded-lg">

        <select id="filter-service"
                [(ngModel)]="filterService" name="filterService"
                class="p-3 border border-gray-300 rounded-lg appearance-none">
          <option value="all">Tous les services</option>
          <option value="fuite">Fuite d'eau urgente</option>
          <option value="installation">Installation robinetterie</option>
          <option value="debouchage">D√©bouchage canalisation</option>
        </select>

        <div class="flex items-center space-x-2 p-3 bg-gray-50 rounded-lg">
          <input type="checkbox" id="filter-urgent"
                 [(ngModel)]="filterUrgent" name="filterUrgent"
                 class="w-4 h-4 text-indigo-600">
          <label for="filter-urgent" class="text-gray-700">Disponible maintenant</label>
        </div>

        <button type="submit" id="apply-filters-btn"
                class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
          Appliquer les filtres
        </button>
      </div>
    </form>
    <section>
      <h3 id="results-count" class="text-2xl font-bold text-gray-800 mb-6">
        {{ filteredPlombiers.length }} Plombiers trouv√©s dans votre r√©gion
      </h3>

      <div id="plumbers-list" class="space-y-6">

        <div *ngFor="let p of filteredPlombiers" class="plumber-card bg-white p-6 rounded-xl shadow-lg border-l-4"
             [ngClass]="p.disponible ? 'border-green-500' : 'border-orange-500'"
             [attr.data-id]="p.id">

          <div class="md:flex md:justify-between md:items-center">
            <div class="flex items-center space-x-4">
              <a href="#" (click)="showPlumberDetails(p.id); $event.preventDefault()">
                <img [src]="'https://placehold.co/80x80/' + (p.disponible ? '059669' : 'f97316') + '/ffffff?text=' + p.initiales"
                     class="w-16 h-16 rounded-full border-2" [ngClass]="p.disponible ? 'border-green-500' : 'border-orange-500'">
              </a>

              <div>
                <a href="#" (click)="showPlumberDetails(p.id); $event.preventDefault()"
                   class="text-xl font-bold text-gray-900 hover:text-indigo-600">
                  {{ p.nom }}
                </a>
                <p class="text-gray-600">{{ p.specialite }}</p>
              </div>
            </div>

            <div class="flex flex-col items-start md:items-end space-y-2 mt-4 md:mt-0">
              <div class="availability-status px-3 py-1 rounded-full"
                   [ngClass]="p.disponible ? 'text-green-700 bg-green-100' : 'text-orange-700 bg-orange-100'">
                {{ p.disponible ? 'Disponible Maintenant' : 'Prochain cr√©neau : Demain 8h00' }}
              </div>

              <p class="text-2xl font-bold text-indigo-600">{{ p.tarif }}</p>

              <button (click)="showPlumberDetails(p.id)"
                      class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                R√©servation
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="filteredPlombiers.length === 0"
           class="text-center p-8 bg-yellow-50 rounded-lg border border-yellow-200 mt-6">
        <p class="text-xl text-yellow-800 font-semibold">
          Aucun plombier ne correspond √† vos crit√®res.
        </p>
      </div>
    </section>
  </section>

  <section id="detail-view" *ngIf="showDetailSection && plombierSelectionne">
    <button (click)="showListView()"
            class="mb-6 inline-flex items-center text-indigo-600 hover:text-indigo-800 transition">
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
      Retour √† la liste
    </button>

    <div id="plumber-details-container"
         class="bg-white p-8 rounded-xl shadow-2xl border border-gray-100">

      <div class="flex flex-col md:flex-row items-start md:items-center space-y-6 md:space-y-0 md:space-x-8">

        <div class="flex-shrink-0">
          <div class="w-32 h-32 rounded-full flex items-center justify-center text-5xl font-bold text-white"
               [ngClass]="plombierSelectionne.disponible ? 'bg-green-600' : 'bg-orange-600'">
            {{plombierSelectionne.initiales}}
          </div>
          <h2 class="text-2xl font-bold text-gray-900 mt-4">{{plombierSelectionne.nom}}</h2>
          <p class="font-semibold" [ngClass]="plombierSelectionne.disponible ? 'text-green-600' : 'text-orange-600'">{{plombierSelectionne.specialite}}</p>
        </div>

        <div class="flex-grow">
          <div class="flex items-center space-x-2 text-gray-500 mb-2">
            <span class="text-red-500">üìç</span>
            <p>{{plombierSelectionne.zone}}</p>
          </div>

          <div class="flex items-center space-x-2 text-gray-800 mb-2">
            <span class="text-yellow-400 text-xl">‚≠êÔ∏è</span>
            <p class="font-bold">{{plombierSelectionne.note}} <span class="text-sm font-normal">({{plombierSelectionne.avisCount}} Avis)</span></p>
          </div>

          <p class="text-4xl font-extrabold text-indigo-600 mb-4">
            {{plombierSelectionne.tarif}}
          </p>

          <p class="text-gray-700 mb-4">
            {{plombierSelectionne.description}} <br>
            <span class="italic text-sm text-gray-500">Devis gratuit sur demande.</span>
          </p>

          <h3 class="text-lg font-bold text-gray-800 mb-2">Services Sp√©cialis√©s</h3>
          <div class="flex flex-wrap gap-2 mb-6">
            <span *ngFor="let service of plombierSelectionne.services"
                  class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
              {{service}}
            </span>
          </div>

          <ng-container *ngIf="reservationStatus === 'accepted'">
            <div class="bg-green-50 p-4 rounded-lg border border-green-300 mb-4">
              <p class="text-green-700 font-semibold flex items-center space-x-2 mb-2">
                <span class="text-2xl">‚úÖ</span>
                <span>R√©servation Accept√©e !</span>
              </p>
              <p class="text-gray-900 mb-3 font-bold">
                Votre code de validation pour le paiement et l'arriv√©e du prestataire est:
                <span class="text-green-700 text-xl">{{validationCode}}</span>
              </p>
              <p class="text-sm text-gray-600 italic">
                Veuillez effectuer le paiement de l'acompte (montant libre) pour confirmer la venue.
              </p>
            </div>

            <button (click)="openPaymentModal()"
                    class="w-full px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition">
              Payer l'acompte
            </button>
          </ng-container>

          <ng-container *ngIf="reservationStatus === 'initial'">
            <div class="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
              <ng-container *ngIf="plombierSelectionne.disponible; else nonDisponible">
                <div class="bg-green-100 text-green-700 font-semibold px-4 py-2 rounded-full flex items-center space-x-2">
                  <span class="w-3 h-3 bg-green-500 rounded-full block"></span>
                  <span>Disponible Maintenant</span>
                </div>
              </ng-container>
              <ng-template #nonDisponible>
                <div class="bg-orange-100 text-orange-700 font-semibold px-4 py-2 rounded-full">
                  Sur r√©servation
                </div>
              </ng-template>

              <button (click)="openReservationModal()"
                      class="px-6 py-3 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 transition">
                R√©server ce Plombier Maintenant
              </button>
            </div>
          </ng-container>

        </div>
      </div>
    </div>
  </section>
</main>

<div id="reservation-modal" class="modal-overlay fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300"
     [ngClass]="{'opacity-100 visible': showReservationModal, 'opacity-0 invisible hidden': !showReservationModal}">
  <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg transform transition-transform duration-300">
    <h2 class="text-2xl font-bold text-indigo-600 mb-6">Finaliser la R√©servation</h2>

    <form id="reservation-form" (ngSubmit)="submitReservation($event)">

      <div class="mb-4">
        <label for="reservation-nom" class="block text-gray-700 font-medium mb-1">Votre Nom Complet</label>
        <input type="text" id="reservation-nom" name="nom" [(ngModel)]="reservationNom" placeholder="Ex: Aliou Diallo"
               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
      </div>

      <div class="mb-4">
        <label for="reservation-telephone" class="block text-gray-700 font-medium mb-1">Num√©ro de T√©l√©phone (pour contact)</label>
        <input type="tel" id="reservation-telephone" name="telephone" [(ngModel)]="reservationTelephone" placeholder="Ex: 77 123 45 67"
               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
      </div>

      <div class="mb-6">
        <label for="reservation-description" class="block text-gray-700 font-medium mb-1">Description du Probl√®me</label>
        <textarea id="reservation-description" name="description" rows="4" [(ngModel)]="reservationDescription"
                  placeholder="D√©crivez bri√®vement la fuite, le d√©bouchage, etc."
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
      </div>

      <div class="flex justify-end space-x-3 mt-6">
        <button type="button" (click)="closeReservationModal()"
                class="px-5 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
          Annuler
        </button>
        <button type="submit"
                class="px-5 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition">
          Envoyer la demande de R√©servation
        </button>
      </div>
    </form>
  </div>
</div>
<div id="payment-modal" class="modal-overlay fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300"
     [ngClass]="{'opacity-100 visible': showPaymentModal, 'opacity-0 invisible hidden': !showPaymentModal}">
  <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg transform transition-transform duration-300">
    <h2 id="payment-title" class="text-2xl font-bold text-indigo-600 mb-4">Payer Acompte pour {{plombierSelectionne?.nom}}</h2>

    <form id="payment-form" (ngSubmit)="submitPayment($event)">

      <div class="mb-4">
        <label for="payment-method" class="block text-gray-700 font-medium mb-1">M√©thode de Paiement</label>
        <select id="payment-method" name="method"
                (change)="onPaymentMethodChange($event)"
                class="w-full p-3 border border-gray-300 rounded-lg appearance-none bg-white focus:ring-indigo-500 focus:border-indigo-500" required>
          <option value="">S√©lectionner une m√©thode</option>
          <option value="orange_money">Orange Money (Simul√©)</option>
          <option value="wave">Wave (Simul√©)</option>
          <option value="carte">Carte Bancaire (Simul√©)</option>
        </select>
      </div>

      <div *ngIf="!selectedPaymentMethod" class="text-center p-4 bg-gray-50 text-gray-600 rounded-lg mb-6">
        Veuillez choisir une m√©thode de paiement ci-dessus pour continuer.
      </div>

      <div *ngIf="selectedPaymentMethod" class="mb-6">
        <label for="payment-amount" class="block text-gray-700 font-medium mb-1">Montant de l'Acompte (XOF)</label>
        <input type="number" id="payment-amount" name="amount"
               [(ngModel)]="paymentAmount"
               placeholder="Montant libre, ex: 5000" min="1"
               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
        <p class="text-sm text-gray-500 mt-1">Montant libre, mais il est recommand√© d'entrer au moins 5000 XOF.</p>
      </div>

      <ng-container *ngIf="selectedPaymentMethod === 'orange_money'">
        <div class="p-4 bg-orange-50 rounded-lg border border-orange-200 mb-6">
          <h4 class="font-bold text-orange-700 mb-3">D√©tails Orange Money</h4>
          <div class="mb-4">
            <label for="om-phone" class="block text-gray-700 font-medium mb-1">Num√©ro Orange Money</label>
            <input type="tel" id="om-phone" name="om-phone"
                   [(ngModel)]="paymentPhoneNumber"
                   placeholder="Ex: 77 123 45 67"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
          </div>
          <p class="text-sm text-orange-700">Vous recevrez une notification sur ce num√©ro pour confirmer la transaction avec votre code secret OM.</p>
        </div>
      </ng-container>

      <ng-container *ngIf="selectedPaymentMethod === 'wave'">
        <div class="p-4 bg-cyan-50 rounded-lg border border-cyan-200 mb-6">
          <h4 class="font-bold text-cyan-700 mb-3">D√©tails Wave</h4>
          <div class="mb-4">
            <label for="wave-phone" class="block text-gray-700 font-medium mb-1">Num√©ro Wave</label>
            <input type="tel" id="wave-phone" name="wave-phone"
                   [(ngModel)]="paymentPhoneNumber"
                   placeholder="Ex: 78 123 45 67"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
          </div>
          <p class="text-sm text-cyan-700">Vous recevrez une notification sur ce num√©ro pour confirmer la transaction avec votre code secret Wave.</p>
        </div>
      </ng-container>

      <ng-container *ngIf="selectedPaymentMethod === 'carte'">
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 mb-6">
          <h4 class="font-bold text-blue-700 mb-3">D√©tails Carte Bancaire</h4>
          <div class="mb-4">
            <label for="card-name" class="block text-gray-700 font-medium mb-1">Nom sur la Carte</label>
            <input type="text" id="card-name" name="card-name"
                   [(ngModel)]="cardName"
                   placeholder="Nom et Pr√©nom"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
          </div>
          <div class="mb-4">
            <label for="card-number" class="block text-gray-700 font-medium mb-1">Num√©ro de Carte</label>
            <input type="text" id="card-number" name="card-number"
                   [(ngModel)]="cardNumber"
                   placeholder="Ex: 4XXX XXXX XXXX XXXX"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="card-expiry" class="block text-gray-700 font-medium mb-1">Expiration (MM/AA)</label>
              <input type="text" id="card-expiry" name="card-expiry"
                     [(ngModel)]="cardExpiry"
                     placeholder="MM/AA"
                     class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
            </div>
            <div>
              <label for="card-cvc" class="block text-gray-700 font-medium mb-1">CVC</label>
              <input type="text" id="card-cvc" name="card-cvc"
                     [(ngModel)]="cardCVC"
                     placeholder="Ex: 123"
                     class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
            </div>
          </div>
        </div>
      </ng-container>

      <div *ngIf="paymentErrorMessage" class="text-red-600 bg-red-50 p-3 rounded-lg border border-red-300 mb-4 font-semibold">
        {{paymentErrorMessage}}
      </div>

      <div *ngIf="selectedPaymentMethod" class="mt-6 flex justify-end space-x-3">
        <button type="button" (click)="closePaymentModal()"
                class="px-5 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
          Annuler
        </button>
        <button type="submit"
                class="px-5 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition">
          Confirmer et Payer {{ paymentAmount ? '(' + paymentAmount + ' XOF)' : '' }}
        </button>
      </div>

      <div *ngIf="!selectedPaymentMethod" class="mt-6 flex justify-end">
        <button type="button" (click)="closePaymentModal()"
                class="px-5 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>
<div id="message-modal" class="modal-overlay fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300"
     [ngClass]="{'opacity-100 visible': showMessageModal, 'opacity-0 invisible hidden': !showMessageModal}">
  <div class="modal-content bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm transform transition-transform duration-300">
    <h2 class="text-xl font-bold text-gray-900 mb-3">{{messageTitle}}</h2>
    <div id="message-content" [innerHTML]="messageContent"></div>

    <button (click)="closeMessageModal()"
            class="mt-4 px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
      OK
    </button>
  </div>
</div>
plomberi.html
